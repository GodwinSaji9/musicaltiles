<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Musical Tiles - Complete Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Exo+2:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --neon-pink: #ff006e;
            --neon-blue: #00f5ff;
            --neon-purple: #8338ec;
            --neon-green: #06ffa5;
            --neon-yellow: #ffbe0b;
            --dark-bg: #0a0a0f;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--dark-bg);
            color: #fff;
            -webkit-user-select: none;
            user-select: none;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255,0,110,0.08) 50%, transparent 70%),
                radial-gradient(circle at 20% 50%, rgba(131,56,236,0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0,245,255,0.1) 0%, transparent 50%);
            background-size: 200% 200%;
            animation: gradientShift 25s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,255,0.02) 2px, rgba(0,255,255,0.02) 4px);
            pointer-events: none;
            z-index: 9999;
            animation: scanline 12s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100px); }
        }

        .grid-bg {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(0,245,255,0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,245,255,0.08) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.4;
            pointer-events: none;
        }

        .neon-text {
            font-family: 'Audiowide', cursive;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 40px currentColor;
            animation: neonPulse 3s ease-in-out infinite;
        }

        @keyframes neonPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        @keyframes slideInFromLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
        }

        #root {
            position: relative;
            z-index: 1;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .tile {
            cursor: pointer;
            user-select: none;
            touch-action: none;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark-bg); }
        ::-webkit-scrollbar-thumb {
            background: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
            border-radius: 4px;
        }

        .neon-button {
            font-family: 'Audiowide', cursive;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .neon-button:hover {
            transform: scale(1.05);
        }

        .neon-button:active {
            transform: scale(0.95);
        }

        .menu-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        const initAudio = () => {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        };

        const playNote = (freq, dur = 0.3) => {
            try {
                initAudio();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = freq;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
                osc.start();
                osc.stop(audioCtx.currentTime + dur);
            } catch (e) {}
        };

        const playErrorSound = () => {
            try {
                initAudio();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = 150;
                osc.type = 'sawtooth';
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } catch (e) {}
        };

        const playSuccessSound = () => {
            try {
                initAudio();
                [523.25, 659.25, 783.99].forEach((f, i) => {
                    setTimeout(() => playNote(f, 0.2), i * 100);
                });
            } catch (e) {}
        };

        const NOTES = {
            C3:130.81, D3:146.83, E3:164.81, F3:174.61, G3:196, A3:220, B3:246.94,
            C4:261.63, D4:293.66, E4:329.63, F4:349.23, G4:392, A4:440, B4:493.88,
            C5:523.25, D5:587.33, E5:659.25, F5:698.46, G5:783.99, A5:880, B5:987.77, C6:1046.5
        };

        const STORAGE_KEY = 'musical_tiles_progress';
        const LEADERBOARD_KEY = 'musical_tiles_leaderboard';

        const loadProgress = () => {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : { completedSongs: [], songScores: {}, songStars: {}, playerName: '' };
            } catch (e) {
                return { completedSongs: [], songScores: {}, songStars: {}, playerName: '' };
            }
        };

        const saveProgress = (prog) => {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(prog));
            } catch (e) {}
        };

        const loadLeaderboard = () => {
            try {
                const saved = localStorage.getItem(LEADERBOARD_KEY);
                return saved ? JSON.parse(saved) : [];
            } catch (e) {
                return [];
            }
        };

        const saveLeaderboard = (leaderboard) => {
            try {
                localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(leaderboard));
            } catch (e) {}
        };

        const addToLeaderboard = (songId, playerName, score, stars, combo) => {
            const leaderboard = loadLeaderboard();
            const entry = {
                songId,
                playerName,
                score,
                stars,
                combo,
                date: new Date().toISOString()
            };
            
            leaderboard.push(entry);
            
            // Sort by score descending and keep top 100
            leaderboard.sort((a, b) => b.score - a.score);
            const trimmed = leaderboard.slice(0, 100);
            
            saveLeaderboard(trimmed);
            return trimmed;
        };

        const getTopScoresForSong = (songId, limit = 10) => {
            const leaderboard = loadLeaderboard();
            return leaderboard
                .filter(entry => entry.songId === songId)
                .slice(0, limit);
        };

        const getGlobalLeaderboard = (limit = 20) => {
            const leaderboard = loadLeaderboard();
            return leaderboard.slice(0, limit);
        };

        const calculateStars = (score, combo, len) => {
            const spn = score / len;
            const cr = combo / len;
            if (spn >= 20 && cr >= 0.9) return 3;
            if (spn >= 15 && cr >= 0.7) return 2;
            if (spn >= 10) return 1;
            return 0;
        };

        const SONGS = [
            {
                id:1, title:"Twinkle Star", artist:"Mozart", difficulty:"Easy", bpm:90, color:"#ff006e",
                melody:[
                    {l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.C4,d:1},{l:2,n:NOTES.G4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:3,n:NOTES.A4,d:1},{l:3,n:NOTES.A4,d:1},{l:2,n:NOTES.G4,d:2},{l:1,n:NOTES.F4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},
                    {l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:2},{l:2,n:NOTES.G4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:0,n:NOTES.D4,d:2}
                ]
            },
            {
                id:2, title:"Ode to Joy", artist:"Beethoven", difficulty:"Easy", bpm:110, color:"#00f5ff",
                melody:[
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.F4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},
                    {l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:1,n:NOTES.E4,d:1.5},{l:0,n:NOTES.D4,d:0.5},{l:0,n:NOTES.D4,d:2},
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.F4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},
                    {l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:0,n:NOTES.D4,d:1.5},{l:0,n:NOTES.C4,d:0.5},{l:0,n:NOTES.C4,d:2}
                ]
            },
            {
                id:3, title:"Happy Birthday", artist:"Traditional", difficulty:"Easy", bpm:95, color:"#ffd700",
                melody:[
                    {l:0,n:NOTES.C4,d:0.75},{l:0,n:NOTES.C4,d:0.25},{l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:2},{l:0,n:NOTES.C4,d:0.75},{l:0,n:NOTES.C4,d:0.25},
                    {l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:1},{l:2,n:NOTES.G4,d:1},{l:1,n:NOTES.F4,d:2},
                    {l:0,n:NOTES.C4,d:0.75},{l:0,n:NOTES.C4,d:0.25},{l:0,n:NOTES.C5,d:1},{l:3,n:NOTES.A4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:2}
                ]
            },
            {
                id:4, title:"Mary's Lamb", artist:"Traditional", difficulty:"Easy", bpm:100, color:"#ff69b4",
                melody:[
                    {l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:1},{l:0,n:NOTES.D4,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:2},{l:0,n:NOTES.D4,d:1},
                    {l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.D4,d:2},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:2,n:NOTES.G4,d:2},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:1},
                    {l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.C4,d:2}
                ]
            },
            {
                id:5, title:"Jingle Bells", artist:"Pierpont", difficulty:"Easy", bpm:120, color:"#00ff88",
                melody:[
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:2},{l:1,n:NOTES.E4,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:2},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:0,n:NOTES.C4,d:1.5},{l:0,n:NOTES.D4,d:0.5},{l:1,n:NOTES.E4,d:4},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.F4,d:1.5},{l:1,n:NOTES.F4,d:0.5},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.E4,d:0.5},
                    {l:1,n:NOTES.E4,d:0.5},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:1},{l:0,n:NOTES.D4,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:2},{l:2,n:NOTES.G4,d:2}
                ]
            },
            {
                id:6, title:"F√ºr Elise", artist:"Beethoven", difficulty:"Medium", bpm:120, color:"#8338ec",
                melody:[
                    {l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.D5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.D5,d:0.5},
                    {l:1,n:NOTES.E5,d:0.5},{l:0,n:NOTES.B4,d:0.5},{l:0,n:NOTES.D5,d:0.5},{l:0,n:NOTES.C5,d:0.5},
                    {l:0,n:NOTES.A4,d:1},{l:0,n:NOTES.C4,d:0.5},{l:1,n:NOTES.E4,d:0.5},{l:0,n:NOTES.A4,d:0.5},
                    {l:0,n:NOTES.B4,d:1.5},{l:1,n:NOTES.E4,d:0.5},{l:2,n:NOTES.G4,d:0.5},{l:0,n:NOTES.B4,d:0.5},
                    {l:0,n:NOTES.C5,d:2},{l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.D5,d:0.5},{l:1,n:NOTES.E5,d:0.5},
                    {l:1,n:NOTES.D5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:0,n:NOTES.B4,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:0,n:NOTES.C5,d:0.5},{l:0,n:NOTES.A4,d:2}
                ]
            },
            {
                id:7, title:"Canon in D", artist:"Pachelbel", difficulty:"Medium", bpm:100, color:"#06ffa5",
                melody:[
                    {l:0,n:NOTES.D4,d:2},{l:3,n:NOTES.A4,d:2},{l:0,n:NOTES.B4,d:2},{l:1,n:NOTES.F4,d:2},
                    {l:2,n:NOTES.G4,d:2},{l:0,n:NOTES.D4,d:2},{l:2,n:NOTES.G4,d:2},{l:3,n:NOTES.A4,d:2},
                    {l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.F4,d:1},{l:3,n:NOTES.A4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:0,n:NOTES.B4,d:1},{l:3,n:NOTES.A4,d:1},{l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:1,n:NOTES.F4,d:1},{l:0,n:NOTES.D4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:1,n:NOTES.F4,d:1},{l:3,n:NOTES.A4,d:2}
                ]
            },
            {
                id:8, title:"Moonlight Sonata", artist:"Beethoven", difficulty:"Medium", bpm:85, color:"#9370db",
                melody:[
                    {l:0,n:NOTES.C4,d:1},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.C4,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.C4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.C4,d:1},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:0,n:NOTES.B3,d:1},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.B3,d:1},
                    {l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.C4,d:1},{l:1,n:NOTES.E4,d:1},
                    {l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.C4,d:1},{l:1,n:NOTES.E4,d:1},{l:2,n:NOTES.G4,d:1}
                ]
            },
            {
                id:9, title:"Eine Kleine", artist:"Mozart", difficulty:"Medium", bpm:130, color:"#ff8c00",
                melody:[
                    {l:2,n:NOTES.G4,d:1},{l:0,n:NOTES.D4,d:0.5},{l:2,n:NOTES.G4,d:0.5},{l:0,n:NOTES.D4,d:0.5},
                    {l:2,n:NOTES.G4,d:0.5},{l:0,n:NOTES.D4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.B4,d:1},
                    {l:2,n:NOTES.G4,d:2},{l:2,n:NOTES.G4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.B4,d:0.5},
                    {l:0,n:NOTES.C5,d:0.5},{l:0,n:NOTES.B4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:2,n:NOTES.G4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.D4,d:2}
                ]
            },
            {
                id:10, title:"Spring - Vivaldi", artist:"Vivaldi", difficulty:"Medium", bpm:140, color:"#32cd32",
                melody:[
                    {l:1,n:NOTES.E5,d:0.5},{l:2,n:NOTES.G5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:2,n:NOTES.G5,d:0.5},
                    {l:1,n:NOTES.E5,d:0.5},{l:2,n:NOTES.G5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:0,n:NOTES.C5,d:1},{l:0,n:NOTES.D5,d:1},{l:1,n:NOTES.E5,d:2},
                    {l:0,n:NOTES.D5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.F5,d:0.5},{l:2,n:NOTES.G5,d:0.5},
                    {l:1,n:NOTES.F5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:0,n:NOTES.D5,d:0.5},{l:0,n:NOTES.C5,d:0.5},
                    {l:0,n:NOTES.D5,d:1},{l:1,n:NOTES.E5,d:1},{l:0,n:NOTES.C5,d:2}
                ]
            },
            {
                id:11, title:"Turkish March", artist:"Mozart", difficulty:"Hard", bpm:140, color:"#ff6b35",
                melody:[
                    {l:0,n:NOTES.B4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:2,n:NOTES.G4,d:0.5},{l:3,n:NOTES.A4,d:0.5},
                    {l:0,n:NOTES.C5,d:1},{l:0,n:NOTES.D5,d:0.5},{l:0,n:NOTES.C5,d:0.5},{l:0,n:NOTES.B4,d:0.5},
                    {l:0,n:NOTES.C5,d:0.5},{l:1,n:NOTES.E5,d:1},{l:0,n:NOTES.B4,d:0.5},{l:3,n:NOTES.A4,d:0.5},
                    {l:2,n:NOTES.G4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.C5,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.F5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:0,n:NOTES.C5,d:1},{l:0,n:NOTES.B4,d:2}
                ]
            },
            {
                id:12, title:"Flight Bumblebee", artist:"Rimsky", difficulty:"Hard", bpm:180, color:"#ffff00",
                melody:[
                    {l:0,n:NOTES.A4,d:0.25},{l:0,n:NOTES.B4,d:0.25},{l:0,n:NOTES.C5,d:0.25},{l:0,n:NOTES.D5,d:0.25},
                    {l:1,n:NOTES.E5,d:0.25},{l:1,n:NOTES.F5,d:0.25},{l:2,n:NOTES.G5,d:0.25},{l:3,n:NOTES.A5,d:0.25},
                    {l:2,n:NOTES.G5,d:0.25},{l:1,n:NOTES.F5,d:0.25},{l:1,n:NOTES.E5,d:0.25},{l:0,n:NOTES.D5,d:0.25},
                    {l:0,n:NOTES.C5,d:0.25},{l:0,n:NOTES.B4,d:0.25},{l:0,n:NOTES.A4,d:0.25},{l:2,n:NOTES.G4,d:0.25},
                    {l:0,n:NOTES.A4,d:0.25},{l:0,n:NOTES.B4,d:0.25},{l:0,n:NOTES.C5,d:0.25},{l:0,n:NOTES.D5,d:0.25},
                    {l:1,n:NOTES.E5,d:0.25},{l:1,n:NOTES.F5,d:0.25},{l:2,n:NOTES.G5,d:0.25},{l:3,n:NOTES.A5,d:0.25},
                    {l:3,n:NOTES.A5,d:0.5},{l:2,n:NOTES.G5,d:0.5},{l:1,n:NOTES.F5,d:0.5},{l:1,n:NOTES.E5,d:0.5}
                ]
            },
            {
                id:13, title:"Hungarian Dance", artist:"Brahms", difficulty:"Hard", bpm:160, color:"#dc143c",
                melody:[
                    {l:0,n:NOTES.D4,d:0.5},{l:1,n:NOTES.F4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:0,n:NOTES.C5,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:1,n:NOTES.F4,d:0.5},{l:0,n:NOTES.D4,d:0.5},
                    {l:1,n:NOTES.E4,d:1},{l:1,n:NOTES.F4,d:1},{l:2,n:NOTES.G4,d:2},
                    {l:0,n:NOTES.D4,d:0.5},{l:1,n:NOTES.F4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.D5,d:0.5},
                    {l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.F5,d:0.5},{l:2,n:NOTES.G5,d:1},{l:1,n:NOTES.F5,d:1},
                    {l:1,n:NOTES.E5,d:1},{l:0,n:NOTES.D5,d:2}
                ]
            },
            {
                id:14, title:"Maple Leaf Rag", artist:"Joplin", difficulty:"Hard", bpm:150, color:"#ff1493",
                melody:[
                    {l:0,n:NOTES.C4,d:0.5},{l:1,n:NOTES.E4,d:0.5},{l:0,n:NOTES.C4,d:0.5},{l:1,n:NOTES.E4,d:0.5},
                    {l:0,n:NOTES.C4,d:0.5},{l:1,n:NOTES.E4,d:0.5},{l:2,n:NOTES.G4,d:0.5},{l:0,n:NOTES.C5,d:0.5},
                    {l:0,n:NOTES.B4,d:0.5},{l:2,n:NOTES.G4,d:0.5},{l:1,n:NOTES.E4,d:0.5},{l:0,n:NOTES.C4,d:0.5},
                    {l:0,n:NOTES.D4,d:0.5},{l:1,n:NOTES.F4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:0,n:NOTES.C5,d:0.5},
                    {l:0,n:NOTES.B4,d:0.5},{l:3,n:NOTES.A4,d:0.5},{l:1,n:NOTES.F4,d:0.5},{l:0,n:NOTES.D4,d:0.5},
                    {l:1,n:NOTES.E4,d:1},{l:0,n:NOTES.C4,d:2}
                ]
            },
            {
                id:15, title:"Ride Valkyries", artist:"Wagner", difficulty:"Hard", bpm:170, color:"#4169e1",
                melody:[
                    {l:0,n:NOTES.B4,d:0.5},{l:0,n:NOTES.B4,d:0.5},{l:0,n:NOTES.D5,d:0.5},{l:0,n:NOTES.B4,d:0.5},
                    {l:2,n:NOTES.G4,d:0.5},{l:0,n:NOTES.B4,d:0.5},{l:3,n:NOTES.A4,d:1},{l:2,n:NOTES.G4,d:1},
                    {l:1,n:NOTES.F4,d:1},{l:2,n:NOTES.G4,d:2},{l:0,n:NOTES.B4,d:0.5},{l:0,n:NOTES.B4,d:0.5},
                    {l:0,n:NOTES.D5,d:0.5},{l:1,n:NOTES.E5,d:0.5},{l:1,n:NOTES.F5,d:0.5},{l:2,n:NOTES.G5,d:0.5},
                    {l:3,n:NOTES.A5,d:1},{l:2,n:NOTES.G5,d:1},{l:1,n:NOTES.F5,d:1},{l:2,n:NOTES.G5,d:2}
                ]
            }
        ];

        const LANE_COLORS = ['#ff006e', '#00f5ff', '#06ffa5', '#ffbe0b'];

        const Menu = ({ onSelectSong }) => {
            const [selectedSong, setSelectedSong] = useState(null);
            const [progress, setProgress] = useState(loadProgress());
            const [showLeaderboard, setShowLeaderboard] = useState(false);

            useEffect(() => {
                setProgress(loadProgress());
            }, []);

            const isSongUnlocked = (song) => {
                if (song.id === 1) return true;
                const prev = SONGS.find(s => s.id === song.id - 1);
                return prev && progress.completedSongs.includes(prev.id);
            };

            const handleSelectSong = useCallback((song) => {
                if (isSongUnlocked(song)) {
                    setSelectedSong(song.id);
                    setTimeout(() => onSelectSong(song), 300);
                }
            }, [onSelectSong, progress]);

            const getSongStars = (id) => progress.songStars[id] || 0;
            const getSongBestScore = (id) => progress.songScores[id] || 0;
            const totalStars = Object.values(progress.songStars).reduce((a, b) => a + b, 0);

            return (
                <div className="menu-container">
                    <div style={{maxWidth:'1400px',margin:'0 auto'}}>
                        <h1 className="neon-text" style={{
                            fontSize:'clamp(2rem,8vw,4rem)',
                            marginBottom:'25px',
                            color:'var(--neon-pink)',
                            textAlign:'center',
                            animation:'scaleIn 0.8s'
                        }}>
                            üéπ MUSICAL TILES
                        </h1>

                        <div style={{display:'flex',gap:'15px',marginBottom:'25px',flexWrap:'wrap',justifyContent:'center'}}>
                            <div style={{
                                background:'rgba(255,0,110,0.2)',
                                border:'2px solid var(--neon-pink)',
                                borderRadius:'12px',
                                padding:'12px 20px',
                                textAlign:'center'
                            }}>
                                <div style={{fontSize:'0.75rem',color:'#aaa',marginBottom:'3px'}}>Total Stars</div>
                                <div style={{fontSize:'1.3rem',color:'var(--neon-yellow)',fontFamily:'Audiowide'}}>‚≠ê {totalStars}</div>
                            </div>

                            <div style={{
                                background:'rgba(0,245,255,0.2)',
                                border:'2px solid var(--neon-blue)',
                                borderRadius:'12px',
                                padding:'12px 20px',
                                textAlign:'center'
                            }}>
                                <div style={{fontSize:'0.75rem',color:'#aaa',marginBottom:'3px'}}>Completed</div>
                                <div style={{fontSize:'1.3rem',color:'var(--neon-green)',fontFamily:'Audiowide'}}>
                                    {progress.completedSongs.length}/{SONGS.length}
                                </div>
                            </div>

                            <button
                                onClick={() => setShowLeaderboard(!showLeaderboard)}
                                className="neon-button"
                                style={{
                                    background:'linear-gradient(135deg,var(--neon-purple),var(--neon-blue))',
                                    border:'2px solid var(--neon-purple)',
                                    borderRadius:'12px',
                                    padding:'12px 20px',
                                    color:'white',
                                    fontSize:'0.85rem',
                                    boxShadow:'0 0 20px var(--neon-purple)'
                                }}
                            >
                                {showLeaderboard ? 'üìã Hide' : 'üèÜ Scores'}
                            </button>
                        </div>

                        {showLeaderboard && (
                            <div style={{
                                background:'rgba(26,26,46,0.9)',
                                border:'3px solid var(--neon-blue)',
                                borderRadius:'15px',
                                padding:'15px',
                                marginBottom:'25px',
                                animation:'scaleIn 0.5s'
                            }}>
                                <h2 style={{
                                    fontSize:'1.3rem',
                                    color:'var(--neon-blue)',
                                    fontFamily:'Audiowide',
                                    marginBottom:'12px',
                                    textAlign:'center',
                                    textShadow:'0 0 20px var(--neon-blue)'
                                }}>
                                    üèÜ Your Best Scores
                                </h2>
                                <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
                                    {SONGS.filter(s => progress.completedSongs.includes(s.id)).map((song, idx) => (
                                        <div key={song.id} style={{
                                            display:'flex',
                                            justifyContent:'space-between',
                                            alignItems:'center',
                                            background:`linear-gradient(90deg,${song.color}22,transparent)`,
                                            border:`2px solid ${song.color}`,
                                            borderRadius:'8px',
                                            padding:'10px 12px'
                                        }}>
                                            <div style={{display:'flex',alignItems:'center',gap:'8px',flex:1}}>
                                                <div style={{fontSize:'1.1rem',fontFamily:'Audiowide',color:'#888',minWidth:'25px'}}>
                                                    #{idx + 1}
                                                </div>
                                                <div style={{flex:1}}>
                                                    <div style={{fontSize:'0.95rem',fontWeight:'bold',color:song.color}}>{song.title}</div>
                                                    <div style={{fontSize:'0.75rem',color:'#aaa'}}>{song.artist}</div>
                                                </div>
                                            </div>
                                            <div style={{textAlign:'right'}}>
                                                <div style={{fontSize:'1.1rem',fontFamily:'Audiowide',color:'var(--neon-yellow)',marginBottom:'2px'}}>
                                                    {getSongBestScore(song.id).toLocaleString()}
                                                </div>
                                                <div style={{fontSize:'0.9rem'}}>
                                                    {'‚≠ê'.repeat(getSongStars(song.id))}{'‚òÜ'.repeat(3 - getSongStars(song.id))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {progress.completedSongs.length === 0 && (
                                        <div style={{textAlign:'center',color:'#666',padding:'15px'}}>
                                            Complete songs to see your scores!
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        <div style={{
                            display:'grid',
                            gridTemplateColumns:'repeat(auto-fill, minmax(230px, 1fr))',
                            gap:'15px',
                            marginBottom:'25px'
                        }}>
                            {SONGS.map((song, idx) => {
                                const unlocked = isSongUnlocked(song);
                                const stars = getSongStars(song.id);
                                const bestScore = getSongBestScore(song.id);

                                return (
                                    <div
                                        key={song.id}
                                        onClick={() => handleSelectSong(song)}
                                        style={{
                                            background: unlocked ? `linear-gradient(135deg,${song.color}22,${song.color}44)` : 'rgba(40,40,60,0.5)',
                                            border:`3px solid ${unlocked ? song.color : '#444'}`,
                                            borderRadius:'12px',
                                            padding:'15px',
                                            cursor: unlocked ? 'pointer' : 'not-allowed',
                                            transition:'all 0.3s',
                                            opacity: unlocked ? 1 : 0.4,
                                            animation: unlocked ? `slideInFromLeft 0.5s ease ${idx * 0.05}s backwards` : 'none',
                                            transform: selectedSong === song.id ? 'scale(0.95)' : 'scale(1)',
                                            boxShadow: unlocked ? `0 0 15px ${song.color}33` : 'none',
                                            position:'relative'
                                        }}
                                        onMouseEnter={(e) => {
                                            if (unlocked) {
                                                e.currentTarget.style.transform = 'scale(1.03) translateY(-2px)';
                                                e.currentTarget.style.boxShadow = `0 5px 25px ${song.color}66`;
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (unlocked && selectedSong !== song.id) {
                                                e.currentTarget.style.transform = 'scale(1)';
                                                e.currentTarget.style.boxShadow = `0 0 15px ${song.color}33`;
                                            }
                                        }}
                                    >
                                        {!unlocked && <div style={{position:'absolute',top:'8px',right:'8px',fontSize:'1.3rem',opacity:0.6}}>üîí</div>}
                                        {stars > 0 && <div style={{position:'absolute',top:'8px',left:'8px',fontSize:'0.9rem'}}>
                                            {'‚≠ê'.repeat(stars)}
                                        </div>}

                                        <div style={{fontSize:'1.15rem',fontWeight:'bold',marginBottom:'6px',color: unlocked ? song.color : '#888',fontFamily:'Audiowide',textShadow: unlocked ? `0 0 8px ${song.color}` : 'none'}}>
                                            {song.title}
                                        </div>

                                        <div style={{fontSize:'0.85rem',color: unlocked ? '#aaa' : '#666',marginBottom:'6px'}}>{song.artist}</div>

                                        {bestScore > 0 && (
                                            <div style={{fontSize:'0.8rem',color:'var(--neon-yellow)',marginBottom:'6px',fontFamily:'Audiowide'}}>
                                                Best: {bestScore.toLocaleString()}
                                            </div>
                                        )}

                                        <div style={{display:'flex',gap:'8px',fontSize:'0.75rem',color: unlocked ? song.color : '#666',fontWeight:'bold'}}>
                                            <span style={{background: unlocked ? `${song.color}22` : 'transparent',padding:'3px 8px',borderRadius:'5px',border:`2px solid ${unlocked ? song.color : '#666'}`}}>
                                                {song.difficulty}
                                            </span>
                                            <span style={{background: unlocked ? `${song.color}22` : 'transparent',padding:'3px 8px',borderRadius:'5px',border:`2px solid ${unlocked ? song.color : '#666'}`}}>
                                                {song.bpm} BPM
                                            </span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <div style={{textAlign:'center',color:'#888',fontSize:'0.85rem',marginBottom:'15px'}}>
                            <div style={{marginBottom:'6px'}}>
                                üéÆ Use <strong style={{color:'var(--neon-blue)'}}>D, F, J, K</strong> keys or tap tiles
                            </div>
                            <div>üèÜ Complete songs to unlock new challenges!</div>
                        </div>
                    </div>
                </div>
            );
        };

        const Game = ({ song, onBack }) => {
            const [tiles, setTiles] = useState([]);
            const [score, setScore] = useState(0);
            const [combo, setCombo] = useState(0);
            const [gameOver, setGameOver] = useState(false);
            const [gameWon, setGameWon] = useState(false);
            const [speedMultiplier, setSpeedMultiplier] = useState(1);
            const [speedMessage, setSpeedMessage] = useState('');
            const [playerName, setPlayerName] = useState('');
            const [nameEntered, setNameEntered] = useState(false);
            const [showGlobalLeaderboard, setShowGlobalLeaderboard] = useState(false);

            const gameActive = useRef(true);
            const tileIdCounter = useRef(0);
            const melodyIndex = useRef(0);
            const nextSpawnTime = useRef(0);
            const tilesHitCount = useRef(0);
            const animationFrameId = useRef(null);
            const lastFrameTime = useRef(Date.now());
            const maxCombo = useRef(0);
            const currentScore = useRef(0);
            const currentSpeedMultiplier = useRef(1);

            const baseSpeed = useMemo(() => (song.bpm / 60) * 200, [song.bpm]);

            useEffect(() => { currentScore.current = score; }, [score]);
            useEffect(() => { currentSpeedMultiplier.current = speedMultiplier; }, [speedMultiplier]);

            // Load saved player name on mount
            useEffect(() => {
                const progress = loadProgress();
                if (progress.playerName) {
                    setPlayerName(progress.playerName);
                }
            }, []);

            useEffect(() => {
                gameActive.current = true;
                const startTime = Date.now();

                const gameLoop = () => {
                    if (!gameActive.current) return;

                    const now = Date.now();
                    const deltaTime = (now - lastFrameTime.current) / 1000;
                    lastFrameTime.current = now;
                    const elapsedTime = (now - startTime) / 1000;

                    const timeBasedSpeed = 1 + (elapsedTime / 45);
                    const scoreBonus = currentScore.current >= 500 ? 0.3 : currentScore.current >= 300 ? 0.2 : currentScore.current >= 150 ? 0.1 : 0;
                    const newSpeed = timeBasedSpeed + scoreBonus;
                    const cappedSpeed = Math.min(newSpeed, 3);

                    if (Math.abs(cappedSpeed - currentSpeedMultiplier.current) > 0.05) {
                        setSpeedMultiplier(cappedSpeed);
                        
                        const speedInt = Math.floor(cappedSpeed * 10);
                        const prevSpeedInt = Math.floor(currentSpeedMultiplier.current * 10);
                        
                        if (speedInt !== prevSpeedInt) {
                            if (cappedSpeed >= 2.5) setSpeedMessage('üöÄ MAX!');
                            else if (cappedSpeed >= 2.0) setSpeedMessage('üí• EXTREME!');
                            else if (cappedSpeed >= 1.6) setSpeedMessage('üî• BLAZING!');
                            else if (cappedSpeed >= 1.3) setSpeedMessage('‚ö° SPEED UP!');
                            
                            setTimeout(() => setSpeedMessage(''), 1500);
                        }
                    }

                    if (melodyIndex.current < song.melody.length && elapsedTime >= nextSpawnTime.current) {
                        const note = song.melody[melodyIndex.current];
                        setTiles(prev => [...prev, {
                            id: tileIdCounter.current++,
                            lane: note.l,
                            y: -100,
                            note: note.n,
                            hit: false
                        }]);
                        
                        nextSpawnTime.current = elapsedTime + ((note.d * 60) / song.bpm);
                        melodyIndex.current++;
                    }

                    setTiles(prev => {
                        const updated = prev.map(tile => {
                            if (tile.hit) return tile;
                            return { ...tile, y: tile.y + (baseSpeed * cappedSpeed * deltaTime) };
                        });

                        updated.forEach(tile => {
                            if (!tile.hit && tile.y > 700) {
                                playErrorSound();
                                gameActive.current = false;
                                setGameOver(true);
                            }
                        });

                        return updated.filter(tile => tile.y < 800);
                    });

                    if (melodyIndex.current >= song.melody.length && tilesHitCount.current >= song.melody.length) {
                        gameActive.current = false;
                        playSuccessSound();
                        setGameWon(true);
                        return;
                    }

                    animationFrameId.current = requestAnimationFrame(gameLoop);
                };

                animationFrameId.current = requestAnimationFrame(gameLoop);

                return () => {
                    gameActive.current = false;
                    if (animationFrameId.current) cancelAnimationFrame(animationFrameId.current);
                };
            }, [song, baseSpeed]);

            const handleHit = useCallback((lane, tileId = null) => {
                if (!gameActive.current) return;

                const hitZone = 550;
                const tolerance = 150;

                setTiles(prevTiles => {
                    let targetIndex;
                    let targetTile;

                    if (tileId !== null) {
                        targetIndex = prevTiles.findIndex(t => t.id === tileId && !t.hit);
                        targetTile = prevTiles[targetIndex];
                    } else {
                        targetIndex = prevTiles.findIndex(t => t.lane === lane && !t.hit && Math.abs(t.y - hitZone) < tolerance);
                        targetTile = prevTiles[targetIndex];
                    }

                    if (!targetTile) return prevTiles;

                    const distance = Math.abs(targetTile.y - hitZone);
                    if (distance >= tolerance) return prevTiles;

                    let points = 10;
                    if (distance < 30) points = 25;
                    else if (distance < 70) points = 18;
                    else if (distance < 120) points = 12;

                    const comboBonus = Math.floor(combo / 5) * 5;
                    points += comboBonus;

                    playNote(targetTile.note, 0.3);

                    tilesHitCount.current++;
                    setScore(prev => prev + points);
                    setCombo(prev => {
                        const newCombo = prev + 1;
                        if (newCombo > maxCombo.current) maxCombo.current = newCombo;
                        return newCombo;
                    });

                    return prevTiles.map((tile, i) => i === targetIndex ? { ...tile, hit: true } : tile);
                });
            }, [combo]);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (!gameActive.current) return;
                    const keyMap = { d: 0, f: 1, j: 2, k: 3 };
                    const lane = keyMap[e.key.toLowerCase()];
                    if (lane !== undefined) {
                        const laneEl = document.querySelector(`[data-lane="${lane}"]`);
                        if (laneEl) {
                            laneEl.style.background = `linear-gradient(180deg, transparent, ${LANE_COLORS[lane]}55 100%)`;
                            setTimeout(() => {
                                laneEl.style.background = currentSpeedMultiplier.current >= 2
                                    ? `linear-gradient(180deg, transparent, ${LANE_COLORS[lane]}33 100%)`
                                    : `linear-gradient(180deg, transparent, ${LANE_COLORS[lane]}1a 100%)`;
                            }, 100);
                        }
                        handleHit(lane);
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [handleHit]);

            const laneGradients = useMemo(() =>
                LANE_COLORS.map(color => ({
                    normal: `linear-gradient(180deg, transparent, ${color}1a 100%)`,
                    speed: `linear-gradient(180deg, transparent, ${color}33 100%)`
                })),
                []
            );

            if (gameOver) {
                return (
                    <div style={{width:'100vw',height:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',background:'rgba(10,10,10,0.95)'}}>
                        <h1 className="neon-text" style={{fontSize:'clamp(2.5rem,10vw,4rem)',marginBottom:'25px',color:'var(--neon-pink)',animation:'shake 0.5s'}}>
                            üíî GAME OVER
                        </h1>
                        <div style={{fontSize:'clamp(2.5rem,12vw,5rem)',color:'var(--neon-yellow)',marginBottom:'15px',fontFamily:'Audiowide',textShadow:'0 0 40px var(--neon-yellow)'}}>
                            {score}
                        </div>
                        <div style={{fontSize:'1.1rem',color:'var(--neon-blue)',marginBottom:'25px',fontFamily:'Audiowide'}}>
                            Max Combo: {maxCombo.current}x
                        </div>
                        <button onClick={onBack} className="neon-button" style={{padding:'12px 40px',background:'linear-gradient(135deg,var(--neon-pink),var(--neon-blue))',borderRadius:'12px',color:'white',fontSize:'1.3rem',boxShadow:'0 0 30px var(--neon-pink)'}}>
                            TRY AGAIN
                        </button>
                    </div>
                );
            }

            if (gameWon) {
                const stars = calculateStars(score, maxCombo.current, song.melody.length);

                const handleSubmit = () => {
                    if (playerName.trim()) {
                        const progress = loadProgress();
                        
                        // Save player name to progress
                        progress.playerName = playerName.trim();
                        
                        // Update song completion
                        if (!progress.completedSongs.includes(song.id)) {
                            progress.completedSongs.push(song.id);
                        }
                        
                        // Update best score if higher
                        if (!progress.songScores[song.id] || progress.songScores[song.id] < score) {
                            progress.songScores[song.id] = score;
                            progress.songStars[song.id] = stars;
                        }
                        
                        saveProgress(progress);
                        
                        // Add to global leaderboard
                        addToLeaderboard(song.id, playerName.trim(), score, stars, maxCombo.current);
                        
                        setNameEntered(true);
                    }
                };

                const topScores = getTopScoresForSong(song.id, 10);
                const globalTop = getGlobalLeaderboard(10);

                return (
                    <div style={{width:'100vw',height:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',background:'rgba(10,10,10,0.95)',overflow:'auto',padding:'20px'}}>
                        <h1 className="neon-text" style={{fontSize:'clamp(2.5rem,10vw,4rem)',marginBottom:'25px',color:'var(--neon-green)',animation:'scaleIn 0.8s'}}>
                            üéâ PERFECT!
                        </h1>
                        <div style={{fontSize:'2.5rem',marginBottom:'15px'}}>
                            {'‚≠ê'.repeat(stars)}{'‚òÜ'.repeat(3 - stars)}
                        </div>
                        <div style={{fontSize:'clamp(2.5rem,12vw,5rem)',color:'var(--neon-yellow)',marginBottom:'15px',fontFamily:'Audiowide',textShadow:'0 0 40px var(--neon-yellow)'}}>
                            {score}
                        </div>
                        <div style={{fontSize:'1.1rem',color:'var(--neon-blue)',marginBottom:'25px',fontFamily:'Audiowide'}}>
                            Max Combo: {maxCombo.current}x
                        </div>

                        {!nameEntered ? (
                            <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:'15px',marginBottom:'20px'}}>
                                <div style={{fontSize:'1.2rem',color:'var(--neon-pink)',fontFamily:'Audiowide',textAlign:'center'}}>
                                    Enter Your Name:
                                </div>
                                <input
                                    type="text"
                                    value={playerName}
                                    onChange={(e) => setPlayerName(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSubmit()}
                                    placeholder="Your Name"
                                    maxLength={20}
                                    autoFocus
                                    style={{
                                        padding:'12px 20px',
                                        fontSize:'1.2rem',
                                        fontFamily:'Audiowide',
                                        background:'rgba(26,26,46,0.8)',
                                        border:'3px solid var(--neon-blue)',
                                        borderRadius:'10px',
                                        color:'white',
                                        textAlign:'center',
                                        width:'250px',
                                        outline:'none'
                                    }}
                                />
                                <button onClick={handleSubmit} className="neon-button" style={{padding:'12px 40px',background:'linear-gradient(135deg,var(--neon-green),var(--neon-blue))',borderRadius:'12px',color:'white',fontSize:'1.3rem',boxShadow:'0 0 30px var(--neon-green)'}}>
                                    SUBMIT SCORE
                                </button>
                            </div>
                        ) : (
                            <div style={{width:'100%',maxWidth:'900px',marginBottom:'20px'}}>
                                <div style={{display:'flex',gap:'10px',marginBottom:'15px',justifyContent:'center',flexWrap:'wrap'}}>
                                    <button
                                        onClick={() => setShowGlobalLeaderboard(false)}
                                        className="neon-button"
                                        style={{
                                            padding:'10px 20px',
                                            background: !showGlobalLeaderboard ? 'var(--neon-blue)' : 'rgba(0,245,255,0.3)',
                                            border:'2px solid var(--neon-blue)',
                                            borderRadius:'10px',
                                            color:'white',
                                            fontSize:'0.9rem'
                                        }}
                                    >
                                        Song Top 10
                                    </button>
                                    <button
                                        onClick={() => setShowGlobalLeaderboard(true)}
                                        className="neon-button"
                                        style={{
                                            padding:'10px 20px',
                                            background: showGlobalLeaderboard ? 'var(--neon-pink)' : 'rgba(255,0,110,0.3)',
                                            border:'2px solid var(--neon-pink)',
                                            borderRadius:'10px',
                                            color:'white',
                                            fontSize:'0.9rem'
                                        }}
                                    >
                                        Global Top 10
                                    </button>
                                </div>

                                <div style={{
                                    background:'rgba(26,26,46,0.9)',
                                    border:'3px solid ' + (showGlobalLeaderboard ? 'var(--neon-pink)' : 'var(--neon-blue)'),
                                    borderRadius:'15px',
                                    padding:'20px',
                                    maxHeight:'300px',
                                    overflowY:'auto'
                                }}>
                                    <h3 style={{
                                        fontSize:'1.3rem',
                                        color: showGlobalLeaderboard ? 'var(--neon-pink)' : 'var(--neon-blue)',
                                        fontFamily:'Audiowide',
                                        marginBottom:'15px',
                                        textAlign:'center',
                                        textShadow: `0 0 20px ${showGlobalLeaderboard ? 'var(--neon-pink)' : 'var(--neon-blue)'}`
                                    }}>
                                        {showGlobalLeaderboard ? 'üåç Global Leaderboard' : `üèÜ ${song.title} - Top Scores`}
                                    </h3>
                                    <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
                                        {(showGlobalLeaderboard ? globalTop : topScores).map((entry, idx) => {
                                            const entrySong = SONGS.find(s => s.id === entry.songId);
                                            return (
                                                <div key={idx} style={{
                                                    display:'flex',
                                                    justifyContent:'space-between',
                                                    alignItems:'center',
                                                    background: entry.playerName === playerName && entry.score === score ? 
                                                        'linear-gradient(90deg,rgba(6,255,165,0.3),transparent)' : 
                                                        'rgba(255,255,255,0.05)',
                                                    border: entry.playerName === playerName && entry.score === score ?
                                                        '2px solid var(--neon-green)' :
                                                        '1px solid rgba(255,255,255,0.1)',
                                                    borderRadius:'8px',
                                                    padding:'10px 12px'
                                                }}>
                                                    <div style={{display:'flex',alignItems:'center',gap:'10px',flex:1}}>
                                                        <div style={{
                                                            fontSize:'1.1rem',
                                                            fontFamily:'Audiowide',
                                                            color: idx === 0 ? '#FFD700' : idx === 1 ? '#C0C0C0' : idx === 2 ? '#CD7F32' : '#888',
                                                            minWidth:'30px',
                                                            fontWeight:'bold'
                                                        }}>
                                                            #{idx + 1}
                                                        </div>
                                                        <div style={{flex:1}}>
                                                            <div style={{fontSize:'1rem',fontWeight:'bold',color:'white'}}>
                                                                {entry.playerName}
                                                                {entry.playerName === playerName && entry.score === score && 
                                                                    <span style={{color:'var(--neon-green)',marginLeft:'8px'}}>‚Üê YOU!</span>
                                                                }
                                                            </div>
                                                            {showGlobalLeaderboard && (
                                                                <div style={{fontSize:'0.8rem',color:'#aaa'}}>
                                                                    {entrySong ? entrySong.title : 'Unknown Song'}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div style={{textAlign:'right'}}>
                                                        <div style={{fontSize:'1.1rem',fontFamily:'Audiowide',color:'var(--neon-yellow)',marginBottom:'2px'}}>
                                                            {entry.score.toLocaleString()}
                                                        </div>
                                                        <div style={{fontSize:'0.9rem'}}>
                                                            {'‚≠ê'.repeat(entry.stars)}
                                                            <span style={{color:'#666',marginLeft:'5px',fontSize:'0.8rem'}}>
                                                                {entry.combo}x
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        {(showGlobalLeaderboard ? globalTop : topScores).length === 0 && (
                                            <div style={{textAlign:'center',color:'#666',padding:'20px'}}>
                                                No scores yet. Be the first!
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <button onClick={onBack} className="neon-button" style={{padding:'12px 40px',background:'linear-gradient(135deg,var(--neon-green),var(--neon-blue))',borderRadius:'12px',color:'white',fontSize:'1.3rem',boxShadow:'0 0 30px var(--neon-green)',marginTop:'20px',display:'block',margin:'20px auto 0'}}>
                                    CONTINUE
                                </button>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div style={{width:'100vw',height:'100vh',display:'flex',flexDirection:'column',overflow:'hidden'}}>
                    <div style={{padding:'12px 15px',background:'rgba(26,26,46,0.9)',borderBottom:'3px solid var(--neon-blue)',display:'flex',justifyContent:'space-between',alignItems:'center',flexWrap:'wrap',gap:'8px',boxShadow:'0 5px 30px rgba(0,245,255,0.3)'}}>
                        <button onClick={onBack} className="neon-button" style={{background:'var(--neon-pink)',padding:'8px 16px',borderRadius:'8px',color:'white',fontSize:'0.9rem',boxShadow:'0 0 20px var(--neon-pink)'}}>
                            ‚Üê MENU
                        </button>

                        <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:'2px'}}>
                            <div style={{fontSize:'clamp(1.2rem,4vw,1.6rem)',fontWeight:'bold',color:'var(--neon-yellow)',fontFamily:'Audiowide',textShadow:'0 0 20px var(--neon-yellow)'}}>
                                {score}
                            </div>
                            {combo > 0 && (
                                <div style={{fontSize:'0.75rem',color:'var(--neon-green)',fontFamily:'Audiowide',animation: combo > 10 ? 'glowPulse 1s infinite' : 'none'}}>
                                    {combo}x COMBO
                                </div>
                            )}
                            {speedMultiplier > 1 && (
                                <div style={{fontSize:'0.7rem',color: speedMultiplier >= 2 ? 'var(--neon-pink)' : 'var(--neon-blue)',fontWeight:'bold',fontFamily:'Audiowide'}}>
                                    {speedMultiplier >= 2.5 && 'üî• '}{speedMultiplier.toFixed(1)}x{speedMultiplier >= 2.5 && ' üî•'}
                                </div>
                            )}
                        </div>

                        <div style={{fontSize:'1rem',color:'var(--neon-green)',fontFamily:'Audiowide',textShadow:'0 0 15px var(--neon-green)'}}>
                            {song.title}
                        </div>
                    </div>

                    <div style={{flex:1,position:'relative',display:'flex',justifyContent:'center',overflow:'hidden',background:'#0a0a0a'}}>
                        {speedMessage && (
                            <div style={{position:'absolute',top:'30%',left:'50%',transform:'translate(-50%,-50%)',fontSize:'clamp(1.6rem,7vw,3.5rem)',fontWeight:'bold',color:'var(--neon-pink)',fontFamily:'Audiowide',textShadow:'0 0 50px var(--neon-pink)',animation:'scaleIn 0.5s',pointerEvents:'none',zIndex:100,textAlign:'center',whiteSpace:'nowrap'}}>
                                {speedMessage}
                            </div>
                        )}

                        <div style={{display:'flex',width:'100%',maxWidth:'600px',height:'100%'}}>
                            {[0, 1, 2, 3].map(lane => (
                                <div key={lane} data-lane={lane} style={{flex:1,position:'relative',borderLeft: lane === 0 ? 'none' : '1px solid rgba(255,255,255,0.1)',background: speedMultiplier >= 2 ? laneGradients[lane].speed : laneGradients[lane].normal,transition:'background 0.1s'}}>
                                    <div style={{position:'absolute',bottom:'150px',width:'100%',height:'8px',background: LANE_COLORS[lane],boxShadow: `0 0 ${speedMultiplier >= 2 ? '40px' : '30px'} ${LANE_COLORS[lane]}`,zIndex:1,transition:'all 0.3s'}} />
                                    <div style={{position:'absolute',bottom:'10px',width:'100%',textAlign:'center',fontSize:'1.8rem',fontWeight:'bold',color: LANE_COLORS[lane],fontFamily:'Audiowide',textShadow: `0 0 25px ${LANE_COLORS[lane]}`,zIndex:1}}>
                                        {['D', 'F', 'J', 'K'][lane]}
                                    </div>
                                    {tiles.filter(t => t.lane === lane && !t.hit).map(tile => (
                                        <div key={tile.id} className="tile" onClick={() => handleHit(tile.lane, tile.id)} onTouchStart={(e) => {e.preventDefault();handleHit(tile.lane, tile.id);}} style={{position:'absolute',top: `${tile.y}px`,width:'100%',height:'80px',background: `linear-gradient(180deg, ${LANE_COLORS[lane]}, ${LANE_COLORS[lane]}dd)`,border: `3px solid ${LANE_COLORS[lane]}`,borderRadius:'10px',boxShadow: `0 0 25px ${LANE_COLORS[lane]}`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:'1.6rem',cursor:'pointer'}}>
                                            üéµ
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [screen, setScreen] = useState('menu');
            const [selectedSong, setSelectedSong] = useState(null);

            const handleSelectSong = useCallback((song) => {
                initAudio();
                setSelectedSong(song);
                setScreen('game');
            }, []);

            const handleBackToMenu = useCallback(() => {
                setScreen('menu');
                setSelectedSong(null);
            }, []);

            return (
                <>
                    {screen === 'menu' && <Menu onSelectSong={handleSelectSong} />}
                    {screen === 'game' && selectedSong && <Game song={selectedSong} onBack={handleBackToMenu} />}
                </>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
